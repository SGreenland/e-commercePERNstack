(this["webpackJsonpe-commerce-ting"]=this["webpackJsonpe-commerce-ting"]||[]).push([[0],{30:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(20),c=n.n(a),s=n(10),i=n(2),o=n(5),l=n(3),u=n.n(l),d=n(8),p=(n(29),n(30),n(16)),m=n(21),j=n(0),b=[{name:"Bananas",details:"(5 pack)",image:Object(j.jsx)("img",{width:"60%",src:"https://images.ctfassets.net/6jpeaipefazr/2RmcxZM3iBnnPzQ1pFZ4Hg/da538d311b629159541cec1aae50ac11/F3_Bananas_1000x1000.jpg?w=1080&h=1080",alt:"bananas"}),price:.8,qty:0,description:"Brazil's finest fair trade bunch of 5 bananas"},{name:"Apples",details:"(4 pack)",image:Object(j.jsx)("img",{width:"60%",src:"https://bellavitashop.co.uk/6288-large_default/red-apples-500g.jpg",alt:"apples"}),price:.4,qty:0,description:"Class 2 succulent Spanish red apples - 4pk."},{name:"Oranges",details:"(4 pack)",image:Object(j.jsx)("img",{width:"60%",src:"https://theartisanfoodcompany.com/wp-content/uploads/2021/05/Navel-Oranges-The-Artisan-Food-Company.jpg",alt:"oranges"}),price:.5,qty:0,description:"Juicy class 1 South African oranges, may contain pips."},{name:"Peaches",details:"(4 pack)",image:Object(j.jsx)("img",{width:"60%",src:"https://static.libertyprim.com/files/familles/peche-large.jpg?1574630286",alt:"peaches"}),price:1.1,qty:0,description:"Perfectly ripe, Class I peaches with a sweet and juicy flavour."},{name:"Melon",details:"(single)",image:Object(j.jsx)("img",{width:"60%",src:"https://static.libertyprim.com/files/familles/melon-large.jpg?1574629891",alt:"Melon"}),price:1.5,qty:0,description:"Sweet and fragrant, packed with vitamins & goodness!"},{name:"Blueberries",details:"(150g)",image:Object(j.jsx)("img",{width:"60%",src:"https://www.redsofa.co.za/wp-content/uploads/products/blueberries-1.png",alt:"blueberries"}),price:1.2,qty:0,description:"Hand picked for freshness, perfect for breakfast! "}],f=Object(p.a)((function(e,t){return{isValidUser:!1,setValidUser:function(){var t=Object(d.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://samsfruitstore-pernstack.herokuapp.com/verify",{credentials:"include"});case 3:if(!(n=t.sent).ok){t.next=8;break}e({isValidUser:!0}),t.next=12;break;case 8:return t.next=10,n.text();case 10:"jwt expired"===t.sent&&(alert("your session has timed out."),e({isValidUser:!1}));case 12:t.next=17;break;case 14:return t.prev=14,t.t0=t.catch(0),t.abrupt("return");case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),userName:"",itemCount:0,addItemCount:function(){return e((function(e){return{itemCount:e.itemCount+1}}))},removeItems:function(){return e({itemCount:0})},products:b,setProdDefault:function(){return e((function(e){return{products:b}}))},itemNames:b.map((function(e){return e.name})),itemPrices:b.map((function(e){return e.price})),greyOut:function(){var e=document.getElementById("formy")||document.getElementById("checkout");e&&(e.style.zIndex="-1"),document.getElementById("root").style.backgroundColor="rgba(0,0,0,0.5)"},filterProducts:function(t){var n=document.getElementById("searchbar").value;"Enter"!==t.key&&t.target!==document.getElementById("searchbtn")||e((function(e){return{products:e.products.filter((function(e){return e.name===n||e.name.toLowerCase()===n}))}}))}}})),h=Object(p.a)(Object(m.persist)((function(e,t){return{cartItems:[]}}),{name:"cart",getStorage:function(){return sessionStorage}})),x=f;var g=function(e){var t=e.name,n=e.price,r=e.image,a=e.qty,c=e.description,s=e.detail,i=h((function(e){return e.cartItems})),o={name:t,qty:a,price:n,description:c};return Object(j.jsx)("div",{className:"product",children:Object(j.jsxs)("div",{id:"innerProd",children:[Object(j.jsxs)("div",{style:{fontWeight:"500"},children:[t,Object(j.jsxs)("span",{style:{fontWeight:"lighter"},children:[" ",s]})]}),Object(j.jsxs)("div",{id:"prodImg",children:[r,Object(j.jsx)("div",{id:"prodDescrip",children:c})]}),Object(j.jsxs)("div",{children:["\xa3",n,"0"]}),Object(j.jsx)("button",{className:"addToCart",onClick:function(){i.push(o);for(var e=0;e<i.length;e++)i[e].name===t&&(i[e].qty++,i[e].price=i[e].qty*n);var r=x.getState().itemCount;h.setState({cartItems:i}),x.setState({itemCount:r+1}),document.getElementById("carty").style.animation="bounce 250ms",setTimeout((function(){return document.getElementById("carty").style.animation="none"}),500)},children:"Add to Cart"})]})})};var O=function(){var e=x((function(e){return e.products}));return Object(j.jsx)("div",{className:"products",children:e.length?e.map((function(e){return Object(j.jsx)(g,{name:e.name,detail:e.details,price:e.price,image:e.image,qty:e.qty,description:e.description})})):"Couldn't find product"})},y=n.p+"static/media/logo.54513202.png";function v(){return Object(j.jsx)("div",{id:"alertBox"})}function k(e){var t=e.item,n=(e.total,h((function(e){return e.cartItems}))),r=x((function(e){return e.products}));var a=h.getState().cartItems,c=r.filter((function(e){return e.name===t.name}));return Object(j.jsxs)("tr",{id:"cartItems",children:[Object(j.jsx)("td",{children:t.name}),Object(j.jsxs)("td",{children:["\xa3",t.price.toFixed(2)]}),Object(j.jsxs)("td",{id:"qtybtnContainer",children:[Object(j.jsx)("button",{id:"qtybtn",onClick:function(){for(var e=0;e<a.length;e++)a[e].name===t.name&&t.qty>1&&(a[e].qty=t.qty-1,a[e].price=t.price-c[0].price);var n=a.slice();h.setState({cartItems:n})},children:"-"}),Object(j.jsx)("div",{style:{paddingInline:"3px",display:"flex",alignItems:"center"},children:t.qty}),Object(j.jsx)("button",{id:"qtybtn",onClick:function(){for(var e=0;e<a.length;e++)a[e].name===t.name&&(a[e].qty=t.qty+1,a[e].price=t.price+c[0].price);var n=a.slice();h.setState({cartItems:n})},children:"+"})]}),Object(j.jsx)("td",{className:"deleteField",children:Object(j.jsx)("button",{className:"cartBtns",onClick:function(){var e=n.slice();e.splice(e.indexOf(t),1),h.setState({cartItems:e});var r=x.getState().itemCount;x.setState({itemCount:r-1})},children:"delete"})})]})}var S=function(e){var t=h((function(e){return e.cartItems})),n=0,a=[],c=x((function(e){return e.products})),i=x((function(e){return e.setValidUser}));Object(r.useEffect)((function(){i(),t.map((function(e){return c.forEach((function(n){n.name===e.name&&(e.price=n.price*e.qty),x.setState({cartItems:t})}))}))})),function(){var e=Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=0;n<t.length;n++)a.push(t[n].price);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()();var o=t.length?a.reduce((function(e,t){return e+t})).toFixed(2):0;return Object(j.jsxs)("div",{className:"cart",children:[Object(j.jsxs)("table",{children:[Object(j.jsx)("thead",{children:Object(j.jsx)("th",{colSpan:"4",id:"cartHead",children:"Cart"})}),t.map((function(e){return Object(j.jsx)(k,{item:t[n++],total:o})})),Object(j.jsxs)("tr",{className:"totalRow",children:[Object(j.jsx)("th",{children:"Total"}),Object(j.jsxs)("td",{children:["\xa3",o]}),Object(j.jsx)("td",{colSpan:"2",id:"clearCartField",children:Object(j.jsx)("button",{className:"clearCart",onClick:function(){h.setState({cartItems:[]}),x.setState({itemCount:0})},children:"Clear Cart"})})]}),Object(j.jsx)("tfoot",{children:Object(j.jsxs)("tr",{children:[Object(j.jsx)("td",{colSpan:"2",children:Object(j.jsx)("button",{className:"cartBtns",children:Object(j.jsx)(s.b,{to:"/",style:{display:"block",width:"100%"},children:"Back"})})}),Object(j.jsx)("td",{colSpan:"2",children:Object(j.jsx)("button",{className:"cartBtns",children:Object(j.jsx)(s.b,{to:{pathname:"/checkout",total:o},style:{display:"block",width:"100%"},children:"Checkout"})})})]})})]}),Object(j.jsx)("div",{children:0===t.length&&Object(j.jsx)("div",{children:"Cart is Empty"})})]})},w=n(12),C=n(23);function I(e){var t=e.total,n=Object(w.useStripe)(),a=Object(w.useElements)(),c=Object(r.useState)(!1),s=Object(o.a)(c,2),i=(s[0],s[1]),l=Object(r.useState)(""),p=Object(o.a)(l,2),m=(p[0],p[1]),b=Object(r.useState)(!0),f=Object(o.a)(b,2),g=(f[0],f[1],Object(r.useState)("")),O=Object(o.a)(g,2),y=O[0],v=O[1],k=Object(r.useState)(sessionStorage.getItem("userEmail")),S=Object(o.a)(k,2),C=S[0],I=S[1],N=x.getState().isValidUser,E=document.getElementsByTagName("progress")[0],B=document.getElementById("alertBox"),q=h((function(e){return e.cartItems}));function P(){E.style.display="flex",setInterval((function(){E.value+=1,10===E.value&&(E.value=1),"flex"===B.style.display&&(E.style.display="none")}),250)}function T(){return(T=Object(d.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P(),t.preventDefault(),m(!0),n&&a){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,n.confirmCardPayment(y,{payment_method:{card:a.getElement(w.CardElement),billing_details:{name:document.getElementById("nameField").value}},receipt_email:document.getElementById("emailField").value});case 7:(r=e.sent).error?(m(!1),x.getState().greyOut(),B.style.display="flex",B.innerHTML="Payment failed: ".concat(r.error.message,'<button><a href="/">Ok</button>')):(m(!1),i(!0),x.getState().greyOut(),B.style.display="flex",B.innerHTML='Payment was successful! <button><a href="/">Ok</button>');case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(d.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://samsfruitstore-pernstack.herokuapp.com/confirm_order",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({total:t,items:q.map((function(e){return[e.name,e.price,e.qty]}))})});case 2:if(!e.sent.ok){e.next=7;break}return e.abrupt("return");case 7:alert("could not process order");case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(r.useEffect)((function(){(function(){var e=Object(d.a)(u.a.mark((function e(){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://samsfruitstore-pernstack.herokuapp.com/pay",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({total:t,items:q})});case 3:if(!(n=e.sent).ok){e.next=9;break}return e.next=7,n.json();case 7:r=e.sent,v(r.clientSecret);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}})()()}),[]);var L={width:"100%",border:"2px outset lightgrey",borderRadius:"4px",height:"3vh",padding:"10px",margin:"5px"};return Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("form",{onSubmit:function(e){return T.apply(this,arguments)},style:{minWidth:"300px",display:"flex",flexDirection:"column",alignItems:"center"},id:"checkout",children:[Object(j.jsx)("label",{children:"Email"}),Object(j.jsx)("input",{id:"emailField",type:"email",placeholder:"Email",style:L,required:!0,value:C,onChange:function(e){I(e.target.value)}}),Object(j.jsx)("label",{for:"nameField",children:"Name"}),Object(j.jsx)("input",{style:L,placeholder:"Name",id:"nameField",required:!0}),Object(j.jsx)("label",{children:"Shipping Address"}),Object(j.jsx)("input",{style:L,placeholder:"Address Line 1",required:!0}),Object(j.jsx)("input",{style:L,placeholder:"Address Line 2",required:!0}),Object(j.jsx)("input",{style:L,placeholder:"Postcode/ZIP",required:!0}),Object(j.jsx)("label",{children:"Card Details"}),Object(j.jsx)("div",{style:{width:"100%",border:"2px outset lightgrey",borderRadius:"4px",padding:"2px",margin:"5px"},children:Object(j.jsx)(w.CardElement,{})}),Object(j.jsx)("button",{id:"payBtn",style:{width:"100%",borderRadius:"4px",margin:"5px"},type:"submit",disabled:!n,onClick:function(e){return F.apply(this,arguments)},onMouseOver:function(){N||(x.getState().greyOut(),B.style.display="flex",B.innerHTML='You must be logged in to make a payment. <button><a href="/login">Ok</a></button>')},children:"Pay"}),Object(j.jsx)("progress",{max:"10",value:"1",style:{width:"100%",display:"none"}})]})})}var N={STRIPE_PUBLIC_KEY:"pk_test_51JSONbCXjj4lbhryTeJsc7C3QfS0mTlcQY3cmJDy78OoOYqWdIKx4GLoDWpX5hBNUhAGaNjGdmg4lY0YSzFARdwr00NpGFhpRx"};c.a.render(Object(j.jsx)(s.a,{children:Object(j.jsxs)(i.c,{children:[Object(j.jsx)(i.a,{exact:!0,path:"/",component:function(e){var t=x((function(e){return e.setValidUser})),n=x((function(e){return e.isValidUser})),a=x((function(e){return e.itemCount})),c=x((function(e){return e.filterProducts})),i=x((function(e){return e.setProdDefault})),o=h((function(e){return e.cartItems})),l=x((function(e){return e.products})),p={width:"50%",textAlign:"center"},m=Object(r.useRef)(l);function b(){return(b=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://samsfruitstore-pernstack.herokuapp.com/logout",{credentials:"include"});case 2:!e.sent.ok&&alert("error"),x.setState({isValidUser:!1});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.useEffect)((function(){for(var e=0;e<o.length;e++)for(var t=function(t){o[e].name===o[t].name&&h.setState({cartItems:o.filter((function(e){return o.indexOf(e)!==t}))})},n=e+1;n<o.length;n++)t(n)})),Object(r.useEffect)((function(){x.setState({itemCount:JSON.parse(sessionStorage.getItem("cart")).state.cartItems.length})})),Object(r.useEffect)((function(){t()}),[]),Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"homepage-nav",children:[Object(j.jsx)("div",{className:"logocontainer",children:Object(j.jsx)("picture",{children:Object(j.jsx)("img",{src:y,alt:"logo",width:"100%",height:"95%"})})}),Object(j.jsxs)("div",{id:"inputcontainer",children:[Object(j.jsx)("input",{id:"searchbar",placeholder:"Search product",onKeyPress:c,onKeyUp:function(e){e.preventDefault();for(var t=function(t){x.setState({products:l.filter((function(n){return n.name.match(e.target.value[t])||n.name.includes(e.target.value[t].toUpperCase())}))})},n=0;n<e.target.value.length;n++)t(n);if("Backspace"===e.key)for(var r=function(t){x.setState({products:m.current.filter((function(n){return n.name.match(e.target.value[t])||n.name.includes(e.target.value[t].toUpperCase())}))})},a=0;a<e.target.value.length;a++)r(a);!e.target.value&&i()}}),Object(j.jsx)("button",{onClick:c,id:"searchbtn",type:"submit",className:"fas fa-search"})]}),Object(j.jsxs)("div",{id:"login-signup",children:[Object(j.jsx)(s.b,{to:"/login",onClick:n&&function(){return b.apply(this,arguments)},style:p,children:n?"Logout":"Login"}),Object(j.jsx)("span",{className:"cartIcon",style:p,children:Object(j.jsx)(s.b,{to:"/cart",class:"fas fa-shopping-cart",id:"carty",children:Object(j.jsxs)("span",{style:{fontFamily:"monospace"},children:[a," "]})})})]})]}),Object(j.jsx)("div",{className:"prodContainer",children:Object(j.jsx)(O,{})})]})}}),Object(j.jsx)(i.a,{exact:!0,path:"/create-account",component:function(){var e=Object(r.useState)(""),t=Object(o.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),s=Object(o.a)(c,2),i=s[0],l=s[1],p=Object(r.useState)(""),m=Object(o.a)(p,2),b=m[0],f=m[1],h=document.getElementById("alertBox"),g=function(){var e=Object(d.a)(u.a.mark((function e(t){var r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,r={userName:n,email:i,password:b},e.next=5,fetch("https://samsfruitstore-pernstack.herokuapp.com/create_user",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r)});case 5:if(!(a=e.sent).ok){e.next=12;break}h.style.display="flex",h.innerHTML='Account created successfully!<button><a href="/login">Login</a></button>',x.getState().greyOut(),e.next=18;break;case 12:return e.next=14,a.json();case 14:c=e.sent,h.style.display="flex",h.innerHTML="".concat("unique_email"===c.constraint&&"Email already registered.","<button onclick = window.location.reload()>Try again</button>"),x.getState().greyOut();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,20]])})));return function(t){return e.apply(this,arguments)}}();return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(v,{}),Object(j.jsxs)("div",{id:"formy",children:[Object(j.jsx)("h1",{children:"Create Account"}),Object(j.jsxs)("form",{onSubmit:g,className:"loginForm",children:[Object(j.jsx)("input",{className:"formInput",required:!0,placeholder:"username",value:n,onChange:function(e){a(e.target.value)}}),Object(j.jsx)("input",{className:"formInput",required:!0,type:"email",placeholder:"email",value:i,onChange:function(e){l(e.target.value)}}),Object(j.jsx)("input",{className:"formInput",id:"pwfield",required:!0,type:"password",pattern:"(?=^.{8,}$)((?=.*\\d)|(?=.*\\W+))(?![.\\n])(?=.*[A-Z])(?=.*[a-z]).*$",title:"Password must be more than 8 characters, contain Upper and lower case letters, a number and a special character.",placeholder:"password",value:b,onChange:function(e){f(e.target.value)}}),Object(j.jsx)("button",{className:"formBtn",type:"submit",children:"Create!"})]})]})]})}}),Object(j.jsx)(i.a,{exact:!0,path:"/login",component:function(){var e=Object(r.useState)(""),t=Object(o.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(o.a)(c,2),l=i[0],p=i[1],m=x((function(e){return e.setValidUser})),b=document.getElementById("alertBox"),f={email:n,password:l};Object(r.useEffect)((function(){return function(){m()}}),[]);var h=function(){var e=Object(d.a)(u.a.mark((function e(t){var r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,fetch("https://samsfruitstore-pernstack.herokuapp.com/login",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(f),withCredentials:!0,credentials:"include"});case 4:if(!(r=e.sent).ok){e.next=16;break}return e.next=8,r.json();case 8:a=e.sent,c=a.userName,sessionStorage.setItem("userEmail",n),b.style.display="flex",b.innerHTML="Welcome ".concat(c,'!<button><a href="/">Start Shopping!</a></button>'),x.getState().greyOut(),e.next=19;break;case 16:b.style.display="flex",b.innerHTML='Email or Password incorrect! <button><a href="/login">Try again</a></button>',x.getState().greyOut();case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),console.error(e.t0.message);case 24:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t){return e.apply(this,arguments)}}();return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(v,{}),Object(j.jsxs)("div",{id:"formy",children:[Object(j.jsx)("h1",{children:"Login"}),Object(j.jsxs)("form",{onSubmit:h,className:"loginForm",children:[Object(j.jsx)("input",{className:"formInput",placeholder:"email",value:n,onChange:function(e){a(e.target.value)}}),Object(j.jsx)("input",{className:"formInput",placeholder:"password",type:"password",value:l,onChange:function(e){p(e.target.value)}}),Object(j.jsx)("button",{className:"formBtn",type:"submit",children:"Login"})]}),Object(j.jsx)(s.b,{to:"/create-account",children:Object(j.jsx)("p",{id:"signupLink",children:"Not got an account? Sign up!"})})]})]})}}),Object(j.jsx)(i.a,{exact:!0,path:"/cart",component:S}),Object(j.jsx)(i.a,{exact:!0,path:"/checkout",component:function(e){var t=h((function(e){return e.cartItems})),n=x((function(e){return e.setValidUser})),a=Object(C.a)(N.STRIPE_PUBLIC_KEY),c=e.location.total;return Object(r.useEffect)((function(){n()})),Object(j.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(j.jsxs)(w.Elements,{stripe:a,children:[Object(j.jsx)(v,{}),Object(j.jsxs)("div",{id:"checkout",children:[Object(j.jsx)("h3",{children:"Order Summary:"}),(t.forEach((function(e){switch(e.name){case"Bananas":e.style="banana";break;case"Apples":e.style="apple";break;case"Oranges":e.style="orange";break;case"Peaches":e.style="peach";break;case"Melon":e.style="melon";break;case"Blueberries":e.style="blueberries";break;default:e.style="none"}})),t.map((function(e){return Object(j.jsxs)("li",{value:e.qty,style:{listStyle:e.style},children:[e.name," x (",e.qty,"): \xa3",e.price.toFixed(2)]})}))),Object(j.jsx)("h3",{children:"Total:"}),"\xa3",t.length?t.map((function(e){return e.price})).reduce((function(e,t){return e+t})).toFixed(2):0,Object(j.jsx)("div",{style:{border:"2px solid #587c03",padding:"8px",width:"min-content",borderRadius:"4px"},children:Object(j.jsx)(I,{total:c})})]})]})})}})]})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.10e4a6c9.chunk.js.map